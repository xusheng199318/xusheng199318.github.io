<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="个人笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="笔记">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="笔记">
<meta property="og:description" content="个人笔记">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="笔记">
<meta name="twitter:description" content="个人笔记">






  <link rel="canonical" href="http://yoursite.com/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>笔记</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>主页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-标签">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-文章">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>文章</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/03/敏捷开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/03/敏捷开发/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">敏捷开发</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-03 16:50:29" itemprop="dateCreated datePublished" datetime="2019-03-03T16:50:29+08:00">2019-03-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="敏捷实践原则"><a href="#敏捷实践原则" class="headerlink" title="敏捷实践原则"></a>敏捷实践原则</h3><blockquote>
<p>最优先要做的是通过尽早的、持续的交付有价值的软件来使客户满意</p>
<p>即使到了开发的后期，也欢迎改变需求。敏捷过程利用变化来为客户创造竞争条件</p>
<p>经常性地交付可以工作的软件，交付的间隔时间越短越好</p>
<p>在整个项目开发期间，业务人员和开发人员必须天天都在一起工作</p>
<p>围绕被激励起来的个人来构建项目。给他们提供所需要的环境和支持，并且新人他们能够完成工作</p>
<p>在团队内部，最具有效果的并且富有效率的传递信息的方式，就是面对面的交谈</p>
<p>工作的软件是首要的进度度量标准</p>
<p>敏捷过程提倡可持续的开发速度</p>
<p>不断地送关注优秀的技能和好的设计会增加敏捷能力</p>
<p>简单</p>
<p>最好的架构、需求和设计出资于自组织的团队</p>
<p>每隔一定时间，团队会在如何才能更有效地工作方面进行反省，然后相应地对自己的行为进行调整</p>
</blockquote>
<h3 id="极限编程及计划"><a href="#极限编程及计划" class="headerlink" title="极限编程及计划"></a>极限编程及计划</h3><blockquote>
<p>极限编程主要由一系列简单却互相以来的实践组成。在收集用户素材时需要和客户反复讨论，以获取对于需求细节的理解</p>
<p>短交付周期：每次迭代通常耗时2周</p>
</blockquote>
<h3 id="重构"><a href="#重构" class="headerlink" title="重构"></a>重构</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratePrimesBase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] generatePrimes(<span class="keyword">int</span> maxValue) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (maxValue &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> s = maxValue + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">boolean</span>[] f = <span class="keyword">new</span> <span class="keyword">boolean</span>[s];</span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; s; i++) &#123;</span><br><span class="line">                f[i] = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            f[<span class="number">0</span>] = f[<span class="number">1</span>] = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> j;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">2</span>; i &lt; Math.sqrt(s) + <span class="number">1</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">2</span> * i; j &lt; s; j += i) &#123;</span><br><span class="line">                    f[j] = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; s; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (f[i]) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span>[] primes = <span class="keyword">new</span> <span class="keyword">int</span>[count];</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; s; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (f[i]) &#123;</span><br><span class="line">                    primes[j++] = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> primes;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码主要是产生素数</p>
<p>重构后代码如下：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratePrimes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span>[] crossedOut;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] generatePrimes(<span class="keyword">int</span> maxValue) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (maxValue &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        uncrossIntegersUpTo(maxValue);</span><br><span class="line">        crossOutMultiples();</span><br><span class="line">        putUncrossedIntegerIntoResult();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putUncrossedIntegerIntoResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        result = <span class="keyword">new</span> <span class="keyword">int</span>[numberOfUncrossedIntegers()];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>, j = <span class="number">0</span>; i &lt; crossedOut.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (crossed(i)) &#123;</span><br><span class="line">                result[j++] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numberOfUncrossedIntegers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; crossedOut.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (crossed(i)) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">crossOutMultiples</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> limit = determineIterationLimit();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; limit; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (crossed(i)) &#123;</span><br><span class="line">                crossOutMultiplesOf(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">crossed</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> crossedOut[i] == <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">crossOutMultiplesOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> multiple = <span class="number">2</span> * i; multiple &lt; crossedOut.length; multiple += i) &#123;</span><br><span class="line">            crossedOut[multiple] = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">determineIterationLimit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (Math.sqrt(crossedOut.length) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uncrossIntegersUpTo</span><span class="params">(<span class="keyword">int</span> maxValue)</span> </span>&#123;</span><br><span class="line">        crossedOut = <span class="keyword">new</span> <span class="keyword">boolean</span>[maxValue + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; crossedOut.length; i++) &#123;</span><br><span class="line">            crossedOut[i] = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>主要是依靠如下单元测试代码保证在重构过程中没有影响到原有的业务逻辑</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPrimes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] nullArray = GeneratePrimes.generatePrimes(<span class="number">0</span>);</span><br><span class="line">    Assert.assertEquals(nullArray.length, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] minArray = GeneratePrimes.generatePrimes(<span class="number">2</span>);</span><br><span class="line">    Assert.assertEquals(minArray.length, <span class="number">1</span>);</span><br><span class="line">    Assert.assertEquals(minArray[<span class="number">0</span>], <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] threeArray = GeneratePrimes.generatePrimes(<span class="number">3</span>);</span><br><span class="line">    Assert.assertEquals(threeArray.length, <span class="number">2</span>);</span><br><span class="line">    Assert.assertEquals(threeArray[<span class="number">0</span>], <span class="number">2</span>);</span><br><span class="line">    Assert.assertEquals(threeArray[<span class="number">1</span>], <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/25/synchronized/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/25/synchronized/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">synchronized</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-25 21:56:41" itemprop="dateCreated datePublished" datetime="2019-02-25T21:56:41+08:00">2019-02-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="互斥锁特性"><a href="#互斥锁特性" class="headerlink" title="互斥锁特性"></a>互斥锁特性</h3><blockquote>
<p><strong>互斥性：</strong>同一时刻只有一个线程对需要同步的代码块进行访问</p>
<p><strong>可见性：</strong>在锁被释放前，对变量进行的修改，对于随后获得该锁的线程可见</p>
</blockquote>
<h3 id="获取对象锁"><a href="#获取对象锁" class="headerlink" title="获取对象锁"></a>获取对象锁</h3><blockquote>
<p><strong>同步代码块：</strong><code>synchronized(this)</code>、<code>synchronized(类实例对象)</code>，锁是小括号中的实例对象</p>
<p><strong>同步非静态方法：</strong>同步非静态方法，锁是当前对象的实例对象</p>
</blockquote>
<h3 id="获取类锁"><a href="#获取类锁" class="headerlink" title="获取类锁"></a>获取类锁</h3><blockquote>
<p><strong>同步代码块：</strong><code>synchronized(类.class)</code>，锁是小括号中的类对象（class对象）</p>
<p><strong>同步静态方法：</strong><code>synchronized static method</code>，锁是当前对象的类对象（class对象）</p>
</blockquote>
<h3 id="synchronized底层原理"><a href="#synchronized底层原理" class="headerlink" title="synchronized底层原理"></a>synchronized底层原理</h3><p><img src="对象内存布局.png" alt="img"></p>
<blockquote>
<p>32位虚拟机中对象头中字段如下</p>
</blockquote>
<p><img src="JAVA对象头.png" alt="img"></p>
<blockquote>
<p>synchronize字节码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncCode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">testS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSync</span><span class="params">()</span></span>;</span><br><span class="line">   descriptor: ()V</span><br><span class="line">   flags: ACC_PUBLIC</span><br><span class="line">   Code:</span><br><span class="line">     stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">        <span class="number">0</span>: aload_0</span><br><span class="line">        <span class="number">1</span>: dup</span><br><span class="line">        <span class="number">2</span>: astore_1</span><br><span class="line">        <span class="number">3</span>: monitorenter</span><br><span class="line">        4: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        7: ldc           #3                  // String hello</span><br><span class="line">        9: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">12</span>: aload_1</span><br><span class="line">       <span class="number">13</span>: monitorexit</span><br><span class="line">       <span class="number">14</span>: goto          <span class="number">22</span></span><br><span class="line">       <span class="number">17</span>: astore_2</span><br><span class="line">       <span class="number">18</span>: aload_1</span><br><span class="line">       <span class="number">19</span>: monitorexit</span><br><span class="line">       <span class="number">20</span>: aload_2</span><br><span class="line">       <span class="number">21</span>: athrow</span><br><span class="line">       <span class="number">22</span>: <span class="keyword">return</span></span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">            <span class="number">4</span>    <span class="number">14</span>    <span class="number">17</span>   any</span><br><span class="line">           <span class="number">17</span>    <span class="number">20</span>    <span class="number">17</span>   any</span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">       line <span class="number">10</span>: <span class="number">4</span></span><br><span class="line">       line <span class="number">11</span>: <span class="number">12</span></span><br><span class="line">       line <span class="number">12</span>: <span class="number">22</span></span><br><span class="line">     StackMapTable: number_of_entries = <span class="number">2</span></span><br><span class="line">       frame_type = <span class="number">255</span> <span class="comment">/* full_frame */</span></span><br><span class="line">         offset_delta = <span class="number">17</span></span><br><span class="line">         locals = [ class com/arthur/multiThread/SyncCode, class java/lang/Object ]</span><br><span class="line">         stack = [ class java/lang/Throwable ]</span><br><span class="line">       frame_type = <span class="number">250</span> <span class="comment">/* chop */</span></span><br><span class="line">         offset_delta = <span class="number">4</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">testS</span><span class="params">()</span></span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_SYNCHRONIZED</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: ldc           #3                  // String hello</span><br><span class="line">         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">15</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过上述字节码，在使用synchronized块时，会使用<code>monitorenter</code>和两个<code>monitorexit</code>来表示进入同步代码块和退出同步代码块，两个退出分别表示正常退出以及异常退出</p>
<p>对于同步方法使用<code>ACC_SYNCHRONIZED</code>来表示该方法是同步的，并且对当前对象实例上锁</p>
</blockquote>
<h3 id="synchronized性能提升（JDK6以后）"><a href="#synchronized性能提升（JDK6以后）" class="headerlink" title="synchronized性能提升（JDK6以后）"></a>synchronized性能提升（JDK6以后）</h3><h4 id="自旋锁："><a href="#自旋锁：" class="headerlink" title="自旋锁："></a>自旋锁：</h4><blockquote>
<p>让线程执行忙循环等待锁释放，不让出CPU。如果锁被其他线程长时间占用，会带来许多性能上的开销。自旋等待时间由PreBlockSpin控制</p>
</blockquote>
<h4 id="自适应自旋："><a href="#自适应自旋：" class="headerlink" title="自适应自旋："></a>自适应自旋：</h4><blockquote>
<p>自旋次数不固定、由前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定</p>
</blockquote>
<h4 id="锁消除："><a href="#锁消除：" class="headerlink" title="锁消除："></a>锁消除：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String str1, String str2)</span> </span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(str1).append(str2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SBWithoutSync sb = <span class="keyword">new</span> SBWithoutSync();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        sb.add(<span class="string">"aaa"</span>, <span class="string">"bbb"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码中由于StringBuffer是一个局部变量，不可能被其他线程引用，所以sb不属于共享资源，JVM会自动消除内部的锁</p>
</blockquote>
<h4 id="锁粗化："><a href="#锁粗化：" class="headerlink" title="锁粗化："></a>锁粗化：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">copyString</span><span class="params">(String target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">100</span>) &#123;</span><br><span class="line">        sb.append(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码中并不是每次调用<code>append</code>方法都加锁，而是只加一次，JVM通过扩大加锁的范围，扩大到append方法的外部，避免反复加锁和解锁</p>
</blockquote>
<h4 id="轻量级锁："><a href="#轻量级锁：" class="headerlink" title="轻量级锁："></a>轻量级锁：</h4><blockquote>
<ol>
<li><p>在代码进入同步块的时候，如果同步对象是无锁状态，则在当前线程中的栈帧中建立一个名为Lock Record的空间</p>
</li>
<li><p>拷贝对象头中Mark Word到Lock Record中</p>
</li>
<li><p>比较Mark Word中的信息与Lock Record中的信息是否一致</p>
</li>
<li><p>一致，将对象头中的锁标志位设置为轻量级锁</p>
</li>
<li><p>不一致，说明有其他线程在操作，升级为重量级锁</p>
</li>
</ol>
<p>上述过程中3、4步骤是原子操作，通过操作系统实现同步</p>
</blockquote>
<h4 id="偏向锁："><a href="#偏向锁：" class="headerlink" title="偏向锁："></a>偏向锁：</h4><blockquote>
<p>如果一个线程获得了锁，那么锁就进入偏向模式，此时Mark Word的结构也变为偏向锁结构，当该线程再次请求锁时，无需再做任何同步操作，即获取锁的过程只需要检查Mark Word的锁标记位为偏向锁及当前线程Id等于Mark Word的ThreadId即可，这样就省去了大量有关锁申请的操作。</p>
<p>不适用于锁竞争比较激烈的多线程场合</p>
</blockquote>
<h4 id="synchronized锁膨胀"><a href="#synchronized锁膨胀" class="headerlink" title="synchronized锁膨胀"></a>synchronized锁膨胀</h4><blockquote>
<p> 无锁 -&gt; 偏向锁 -&gt; 轻量级锁 -&gt; 重量级锁</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/23/多线程基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/23/多线程基础/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">多线程基础</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-23 10:22:16" itemprop="dateCreated datePublished" datetime="2019-02-23T10:22:16+08:00">2019-02-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="创建线程的方式"><a href="#创建线程的方式" class="headerlink" title="创建线程的方式"></a>创建线程的方式</h3><blockquote>
<p>继承<code>Thread</code>类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"haha"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实现<code>Runnable</code>接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"haha"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实现<code>Callable</code>接口</p>
<p>实现该接口可以获取线程执行完成的参数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello Callable"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//普通调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCallable</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    FutureTask&lt;String&gt; task = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> MyCallable());</span><br><span class="line">    <span class="keyword">new</span> Thread(task).start();</span><br><span class="line">    <span class="keyword">if</span> (!task.isDone()) &#123;</span><br><span class="line">        System.out.println(<span class="string">"Task is wait"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(task.get());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//线程池调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ExecutorService es = Executors.newCachedThreadPool();</span><br><span class="line">    Future&lt;String&gt; task = es.submit(<span class="keyword">new</span> MyCallable());</span><br><span class="line">    <span class="keyword">if</span> (!task.isDone()) &#123;</span><br><span class="line">        System.out.println(<span class="string">"task is wait"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(task.get());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        es.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h3><blockquote>
<p>新建（NEW）：创建后尚未启动的线程状态</p>
<p>运行（RUNNABLE）：包含Ready和Running</p>
<p>阻塞（BLOCKED）：等待获取排它锁。例如：等待锁进入synchronize块</p>
<p>等待（WAITING）：不会被分配CPU执行时间，需要显示被唤醒。例如调用了<code>Object.wait</code>，<code>Thread.join</code>，<code>LockSupport.park</code>就会一直等待除非被唤醒</p>
<p>限期等待（TIMED_WAITING）：在一定时间后由系统自动唤醒。例如：<code>Object.wait(10)</code>，<code>Thread.join(10)</code>，<code>LockSupport.parkNanos(10)</code>,<code>LockSupport.parkUntil(10)</code></p>
<p>终止状态（TERMINATED）：线程执行完成</p>
</blockquote>
<h3 id="Sleep和Wait区别"><a href="#Sleep和Wait区别" class="headerlink" title="Sleep和Wait区别"></a>Sleep和Wait区别</h3><blockquote>
<p>Sleep和Wait方法都可以放线程让出CPU时间</p>
<p>Sleep是Thread类中的方法，但是Wait是Object类中的方法</p>
<p>Sleep仅让出CPU但不释放锁等资源，Wait会释放锁资源</p>
<p>Wait必须在<code>synchronize</code>中执行</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSleepAndWait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">"Enter Thread 1"</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"Thread 1 got the lock"</span>);</span><br><span class="line">                Thread.sleep(<span class="number">20</span>);</span><br><span class="line">                System.out.println(<span class="string">"Thread 1 do wait method"</span>);</span><br><span class="line">                lock.wait(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(<span class="string">"Thread 1 is done"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">"Enter Thread 2"</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"Thread 2 got the lock"</span>);</span><br><span class="line">                Thread.sleep(<span class="number">10</span>);</span><br><span class="line">                System.out.println(<span class="string">"Thread 2 is done"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码Thread1中如果使用wait方法会把lock释放，而Thread1如果不使用wait方法的话就会导致线程2阻塞，一直等待线程1释放锁资源</p>
<h3 id="notify和notifyAll"><a href="#notify和notifyAll" class="headerlink" title="notify和notifyAll"></a>notify和notifyAll</h3><blockquote>
<p>notify：从等待池中的线程中随机唤醒一个线程</p>
<p>notifyAll：将等待池中的所有线程唤醒</p>
<p>这两个方法都需要在<code>synchronize</code>中执行</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifyTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Object lock;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Enter Thread "</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                lock.wait();</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">" is done"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNotify</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">    NotifyTest notifyTest = <span class="keyword">new</span> NotifyTest(lock);</span><br><span class="line">    Thread t1 = <span class="keyword">new</span> Thread(notifyTest);</span><br><span class="line">    Thread t2 = <span class="keyword">new</span> Thread(notifyTest);</span><br><span class="line">    Thread t3 = <span class="keyword">new</span> Thread(notifyTest);</span><br><span class="line"></span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    t3.start();</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        <span class="comment">//lock.notify();</span></span><br><span class="line">        lock.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在测试方法中如果调用的是<code>notify</code>方法的话，那么在3个<code>wait</code>线程中只会被随机唤醒其中1个，其他2个线程会一直阻塞。而如果调用的是<code>notifyAll</code>方法的话就会唤醒所有在<code>wait</code>状态中的线程</p>
<h3 id="yield方法"><a href="#yield方法" class="headerlink" title="yield方法"></a>yield方法</h3><blockquote>
<p>该方法表示让当前线程可以让出CPU时间，回到Runnable状态，但是并不一定真正让出CPU时间，具体还是要看操作系统调度</p>
</blockquote>
<h3 id="interrupt方法"><a href="#interrupt方法" class="headerlink" title="interrupt方法"></a>interrupt方法</h3><blockquote>
<p>如果线程处于被阻塞状态，那么线程将立即退出并抛出<code>InterruptedException</code></p>
<p>如果线程处于活动状态，那么会讲该线程中断位设置为true。被设置中断的线程将继续正常运营，不受影响</p>
<p>可以通过<code>Thread.interrupted()</code>方法判断当前方法是否被中断了</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/19/GC算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/19/GC算法/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">GC算法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-19 12:34:34" itemprop="dateCreated datePublished" datetime="2019-02-19T12:34:34+08:00">2019-02-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="标记-整理算法"><a href="#标记-整理算法" class="headerlink" title="标记-整理算法"></a>标记-整理算法</h3><blockquote>
<p>标记-整理算法首先将可回收对象进行回收，回收后将存活对象向一端移动</p>
<p>一般用于老年代回收</p>
</blockquote>
<p><img src="标记-整理算法.png" alt="img"></p>
<h3 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h3><blockquote>
<p>复制算法将内存分为3块区域：<code>eden</code>，<code>s0</code>，<code>s1</code>，默认比例为8:1:1</p>
<p>对象默认在<code>eden</code>区进行创建</p>
<p>当第一次GC时将<code>eden</code>区中存活的对象放入<code>s0</code>中</p>
<p>第二次时将<code>eden</code>和<code>s0</code>中的存活对象放入<code>s1</code>中</p>
<p>第三次将<code>eden</code>和<code>s1</code>中的存活对象放入<code>s0</code>中</p>
<p>当<code>s0</code>和<code>s1</code>空间不够时由老年代进行过空间分配担保</p>
<p>该算法一般用于新生代回收</p>
</blockquote>
<p><img src="复制算法.png" alt="img"></p>
<h3 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h3><p><img src="垃圾收集器.png" alt="img"></p>
<center>上图中连线代表他们可以搭配使用</center>

<h4 id="Serial收集器"><a href="#Serial收集器" class="headerlink" title="Serial收集器"></a>Serial收集器</h4><blockquote>
<p>单线程收集器，在进行垃圾收集时必须暂停所有其他工作线程，直到它收集结束</p>
<p>新生代：复制算法，暂停所有用户线程</p>
<p>使用参数：-XX:+UseSerialGC</p>
</blockquote>
<h4 id="Serial-Old收集器"><a href="#Serial-Old收集器" class="headerlink" title="Serial Old收集器"></a>Serial Old收集器</h4><blockquote>
<p>Serial收集器的老年代版本</p>
<p>老年代：标记-整理算法，暂停所有用户线程</p>
<p>使用参数：-XX:+UseSerialGC</p>
</blockquote>
<h4 id="ParNew收集器"><a href="#ParNew收集器" class="headerlink" title="ParNew收集器"></a>ParNew收集器</h4><blockquote>
<p>Serial收集器的多线程版本</p>
<p>新生代：复制算法，多线程垃圾收集，暂停所有用户线程</p>
<p>使用参数：-XX:+UseParNewGC</p>
</blockquote>
<h4 id="Parallel-Scavenge收集器"><a href="#Parallel-Scavenge收集器" class="headerlink" title="Parallel Scavenge收集器"></a>Parallel Scavenge收集器</h4><blockquote>
<p>该收集器的目标是达到一个可控制的吞吐量，高吞吐量可以高效利用CPU时间，尽快完成任务，适合后台运算而不需要太多交互的任务。</p>
<p>吞吐量=运行用户代码时间/（运行用户代码时间 + 垃圾收集时间），虚拟机运行了100分钟，垃圾收集花费1分钟，吞吐量为99%</p>
<p>新生代：复制算法，多线程垃圾收集，暂停所有用户线程</p>
<p>使用参数：-XX:+UseParallelGC</p>
<p>-XX：MaxGCPauseMillis：大于0的毫秒数，收集器尽可能保证回收花费的时间不超过设定值</p>
<p>-XX：GCTimeRatio：大于0小于100的整数，就是垃圾收集时间占总时间的比率，相当于是吞吐量的倒数。如果把此参数设置为19，那允许的最大GC时间就占总时间的5%（即1/（1+19）），默认值为99，就是允许最大1%（即1/（1+99））的垃圾收集时间</p>
<p>-XX：+UseAdaptiveSizePolicy：当这个参数打开之后，就不需要手工指定新生代的大小（-Xmn）、<br>Eden与Survivor区的比例（-XX：SurvivorRatio）、晋升老年代对象年龄（-XX：<br>PretenureSizeThreshold）等细节参数了，虚拟机会根据当前系统的运行情况收集性能监控信<br>息，动态调整这些参数以提供最合适的停顿时间或者最大的吞吐量，这种调节方式称为GC<br>自适应的调节策略</p>
</blockquote>
<h4 id="Parallel-Old收集器"><a href="#Parallel-Old收集器" class="headerlink" title="Parallel Old收集器"></a>Parallel Old收集器</h4><blockquote>
<p>Parallel Scavenge收集器的老年代版本</p>
<p>老年代：标记-整理算法</p>
<p>使用参数：-XX:+UseParallelOldGC</p>
</blockquote>
<h4 id="CMS收集器"><a href="#CMS收集器" class="headerlink" title="CMS收集器"></a>CMS收集器</h4><blockquote>
<p>该收集器是一种以获取最短回收停顿时间为目标的收集器</p>
<p>该收集器收集分为4个步骤：初始标记（Stop The World），并发标记，重新标记（Stop The World），并发清除</p>
<p>老年代：标记-清除算法</p>
<p>使用参数：-XX:+UseConcMarkSweepGC</p>
<p>缺点：对CPU资源敏感，无法处理浮动垃圾（并发清除时用户线程还在运行产生新的垃圾），基于标记-清除进行收集（产生内存碎片）</p>
<p>-XX：+UseCMSCompactAtFullCollection：在顶不住需要FullGC时进行内存碎片合并（默认开启）</p>
<p>-XX：CMSFullGCsBeforeCompaction：设置执行多少次不压缩的Full  GC后，跟着来一次带压缩的（默认值为0，表示每次进入FullGC时都进行碎片整理）</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/16/内存分配及回收策略/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/16/内存分配及回收策略/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">内存分配及回收策略</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-16 20:22:04" itemprop="dateCreated datePublished" datetime="2019-02-16T20:22:04+08:00">2019-02-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="堆内存.png" alt="img"></p>
<h3 id="新生代"><a href="#新生代" class="headerlink" title="新生代"></a>新生代</h3><blockquote>
<p>新生代分为<code>eden</code>区和2个<code>survivor</code>区，默认比例为8:1:1</p>
<p>可通过参数<code>-XX:SurvivorRatio=8</code>进行配置</p>
<p>默认大小为物理内存的 1/64</p>
<p>垃圾收集策略：<strong>复制算法</strong></p>
</blockquote>
<h4 id="eden区"><a href="#eden区" class="headerlink" title="eden区"></a>eden区</h4><blockquote>
<p>当我们使用<code>new</code>关键字创建对象的时候该对象被分配在堆内存中的新生代中的<code>eden</code>区中</p>
</blockquote>
<h4 id="survivor区"><a href="#survivor区" class="headerlink" title="survivor区"></a>survivor区</h4><blockquote>
<p>进行一些GC后仍存活的对象进入<code>survivor</code>区，<code>survivor</code>区默认有2块空间，s0和s1，有1块一直都为空</p>
</blockquote>
<h3 id="老年代"><a href="#老年代" class="headerlink" title="老年代"></a>老年代</h3><blockquote>
<p>为新生代提供担保机制。当创建的对象无法在新生代分配时或在新生代经历多次GC（默认15次）后仍存活的对象会被分配到老年代</p>
<p>垃圾收集策略：<strong>标记整理</strong></p>
</blockquote>
<h4 id="大对象直接进入老年代"><a href="#大对象直接进入老年代" class="headerlink" title="大对象直接进入老年代"></a>大对象直接进入老年代</h4><blockquote>
<p>大对象：需要大量连续内存空间的对象，例如：长字符串和数组</p>
<p>-XX：PretenureSizeThreshold=3145728（3M）当创建的对象大于该值时直接在老年代分配（该参数只对Serial和ParNew收集器有效）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -verbose:gc -Xms20M -Xmx20M -Xmn10M</span></span><br><span class="line"><span class="comment"> * -XX:+PrintGCDetails -XX:+UseSerialGC -XX:PretenureSizeThreshold=3145728</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEden</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] allocation;</span><br><span class="line">    allocation = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">5</span> * m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">6361</span>K [<span class="number">0x00000000f9a00000</span>, <span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fa400000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K,  <span class="number">77</span>% used [<span class="number">0x00000000f9a00000</span>, <span class="number">0x00000000fa0364e0</span>, <span class="number">0x00000000fa200000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000fa200000</span>, <span class="number">0x00000000fa200000</span>, <span class="number">0x00000000fa300000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000fa300000</span>, <span class="number">0x00000000fa300000</span>, <span class="number">0x00000000fa400000</span>)</span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">5120</span>K [<span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fae00000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,  <span class="number">50</span>% used [<span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fa900010</span>, <span class="number">0x00000000fa900200</span>, <span class="number">0x00000000fae00000</span>)</span><br><span class="line"> compacting perm gen  total <span class="number">21248</span>K, used <span class="number">4938</span>K [<span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fc2c0000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">21248</span>K,  <span class="number">23</span>% used [<span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fb2d2b90</span>, <span class="number">0x00000000fb2d2c00</span>, <span class="number">0x00000000fc2c0000</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码中将大于3M的对象直接分配到老年代</p>
</blockquote>
<h4 id="长期存活的对象进入老年代"><a href="#长期存活的对象进入老年代" class="headerlink" title="长期存活的对象进入老年代"></a>长期存活的对象进入老年代</h4><blockquote>
<p>对象在<code>eden</code>中出生后且经过一次GC后且可以被<code>Survivor</code>容纳的话该对象的Age就为1，在<code>Survivor</code>中每经过一次GC该对象的Age就会+1，当它的Age到一定阈值（默认为15）后就晋升到老年代</p>
<p>-XX：MaxTenuringThreshold=1 对象晋升老年代阈值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -verbose:gc -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * -Xms20M -Xmx20M -Xmn10M -XX:+UseSerialGC</span></span><br><span class="line"><span class="comment"> * -XX:MaxTenuringThreshold=1 -XX:+PrintTenuringDistribution</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMaxTenuringThreshold</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] allocation1, allocation2, allocation3;</span><br><span class="line">    allocation1 = <span class="keyword">new</span> <span class="keyword">byte</span>[m / <span class="number">4</span>];</span><br><span class="line">    allocation2 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span> * m];</span><br><span class="line">    allocation3 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span> * m];</span><br><span class="line">    allocation3 = <span class="keyword">null</span>;</span><br><span class="line">    allocation3 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span> * m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[GC[DefNew</span><br><span class="line">Desired survivor size <span class="number">524288</span> bytes, <span class="keyword">new</span> threshold <span class="number">1</span> (max <span class="number">1</span>)</span><br><span class="line">- age   <span class="number">1</span>:    <span class="number">1048568</span> bytes,    <span class="number">1048568</span> total</span><br><span class="line">: <span class="number">6584</span>K-&gt;<span class="number">1023</span>K(<span class="number">9216</span>K), <span class="number">0.0078471</span> secs] <span class="number">6584</span>K-&gt;<span class="number">1264</span>K(<span class="number">19456</span>K), <span class="number">0.0079195</span> secs] [Times: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">[GC[DefNew</span><br><span class="line">Desired survivor size <span class="number">524288</span> bytes, <span class="keyword">new</span> threshold <span class="number">1</span> (max <span class="number">1</span>)</span><br><span class="line">- age   <span class="number">1</span>:        <span class="number">136</span> bytes,        <span class="number">136</span> total</span><br><span class="line">: <span class="number">5204</span>K-&gt;<span class="number">0</span>K(<span class="number">9216</span>K), <span class="number">0.0053484</span> secs] <span class="number">5444</span>K-&gt;<span class="number">1081</span>K(<span class="number">19456</span>K), <span class="number">0.0054182</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">[GC[DefNew</span><br><span class="line">Desired survivor size <span class="number">524288</span> bytes, <span class="keyword">new</span> threshold <span class="number">1</span> (max <span class="number">1</span>)</span><br><span class="line">: <span class="number">4096</span>K-&gt;<span class="number">0</span>K(<span class="number">9216</span>K), <span class="number">0.0027322</span> secs] <span class="number">5177</span>K-&gt;<span class="number">1081</span>K(<span class="number">19456</span>K), <span class="number">0.0027733</span> secs] [Times: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">4247</span>K [<span class="number">0x00000000f9a00000</span>, <span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fa400000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K,  <span class="number">51</span>% used [<span class="number">0x00000000f9a00000</span>, <span class="number">0x00000000f9e25d08</span>, <span class="number">0x00000000fa200000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000fa300000</span>, <span class="number">0x00000000fa300000</span>, <span class="number">0x00000000fa400000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000fa200000</span>, <span class="number">0x00000000fa200000</span>, <span class="number">0x00000000fa300000</span>)</span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">1081</span>K [<span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fae00000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,  <span class="number">10</span>% used [<span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fa50e430</span>, <span class="number">0x00000000fa50e600</span>, <span class="number">0x00000000fae00000</span>)</span><br><span class="line"> compacting perm gen  total <span class="number">21248</span>K, used <span class="number">4938</span>K [<span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fc2c0000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">21248</span>K,  <span class="number">23</span>% used [<span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fb2d2b90</span>, <span class="number">0x00000000fb2d2c00</span>, <span class="number">0x00000000fc2c0000</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p> allocation1对象需要256KB内存，<code>Survivor</code>空间可以容纳，所以在第一次GC时allocation1会进入<code>Survivor</code>空间，在第二次GC时它进入了老年代</p>
</blockquote>
<h4 id="动态对象年龄判定"><a href="#动态对象年龄判定" class="headerlink" title="动态对象年龄判定"></a>动态对象年龄判定</h4><blockquote>
<p>虚拟机并不是永远要求对象的年龄必须达到<code>MaxTenuringThreshold</code>才晋升到老年代，如果<code>Survivor</code>空间中相同年龄所有对象大小的总和大于<code>Survivor</code>空间的一半，年龄大于或等于该年龄的对象直接进入老年代，无需等到<code>MaxTenuringThreshold</code>中要求的年龄</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -verbose:gc -Xms20M -Xmx20M  -Xmn10M</span></span><br><span class="line"><span class="comment"> * -XX:+PrintGCDetails -XX:SurvivorRatio=8</span></span><br><span class="line"><span class="comment"> * -XX:MaxTenuringThreshold=15 -XX:+UseSerialGC</span></span><br><span class="line"><span class="comment"> * -XX:+PrintTenuringDistribution</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMaxTenuringThreshold1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] allocation1, allocation2, allocation3, allocation4;</span><br><span class="line">    allocation1 = <span class="keyword">new</span> <span class="keyword">byte</span>[m / <span class="number">4</span>];</span><br><span class="line">    allocation2 = <span class="keyword">new</span> <span class="keyword">byte</span>[m / <span class="number">2</span>];</span><br><span class="line">    allocation3 = <span class="keyword">new</span> <span class="keyword">byte</span>[m * <span class="number">4</span>];</span><br><span class="line">    allocation4 = <span class="keyword">new</span> <span class="keyword">byte</span>[m * <span class="number">4</span>];</span><br><span class="line">    allocation4 = <span class="keyword">null</span>;</span><br><span class="line">    allocation4 = <span class="keyword">new</span> <span class="keyword">byte</span>[m * <span class="number">4</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[GC[DefNew</span><br><span class="line">Desired survivor size <span class="number">524288</span> bytes, <span class="keyword">new</span> threshold <span class="number">1</span> (max <span class="number">15</span>)</span><br><span class="line">- age   <span class="number">1</span>:    <span class="number">1048576</span> bytes,    <span class="number">1048576</span> total</span><br><span class="line">: <span class="number">7093</span>K-&gt;<span class="number">1024</span>K(<span class="number">9216</span>K), <span class="number">0.0068300</span> secs] <span class="number">7093</span>K-&gt;<span class="number">1264</span>K(<span class="number">19456</span>K), <span class="number">0.0069039</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">[GC[DefNew</span><br><span class="line">Desired survivor size <span class="number">524288</span> bytes, <span class="keyword">new</span> threshold <span class="number">15</span> (max <span class="number">15</span>)</span><br><span class="line">- age   <span class="number">1</span>:        <span class="number">136</span> bytes,        <span class="number">136</span> total</span><br><span class="line">: <span class="number">5203</span>K-&gt;<span class="number">0</span>K(<span class="number">9216</span>K), <span class="number">0.0056466</span> secs] <span class="number">5444</span>K-&gt;<span class="number">1168</span>K(<span class="number">19456</span>K), <span class="number">0.0056887</span> secs] [Times: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">[GC[DefNew</span><br><span class="line">Desired survivor size <span class="number">524288</span> bytes, <span class="keyword">new</span> threshold <span class="number">15</span> (max <span class="number">15</span>)</span><br><span class="line">- age   <span class="number">2</span>:        <span class="number">136</span> bytes,        <span class="number">136</span> total</span><br><span class="line">: <span class="number">4096</span>K-&gt;<span class="number">0</span>K(<span class="number">9216</span>K), <span class="number">0.0022093</span> secs] <span class="number">5264</span>K-&gt;<span class="number">1168</span>K(<span class="number">19456</span>K), <span class="number">0.0022431</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">4242</span>K [<span class="number">0x00000000f9a00000</span>, <span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fa400000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K,  <span class="number">51</span>% used [<span class="number">0x00000000f9a00000</span>, <span class="number">0x00000000f9e24928</span>, <span class="number">0x00000000fa200000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000fa300000</span>, <span class="number">0x00000000fa300088</span>, <span class="number">0x00000000fa400000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000fa200000</span>, <span class="number">0x00000000fa200000</span>, <span class="number">0x00000000fa300000</span>)</span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">1168</span>K [<span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fae00000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,  <span class="number">11</span>% used [<span class="number">0x00000000fa400000</span>, <span class="number">0x00000000fa524330</span>, <span class="number">0x00000000fa524400</span>, <span class="number">0x00000000fae00000</span>)</span><br><span class="line"> compacting perm gen  total <span class="number">21248</span>K, used <span class="number">4938</span>K [<span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fc2c0000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">21248</span>K,  <span class="number">23</span>% used [<span class="number">0x00000000fae00000</span>, <span class="number">0x00000000fb2d2b90</span>, <span class="number">0x00000000fb2d2c00</span>, <span class="number">0x00000000fc2c0000</span>)</span><br><span class="line">No shared spaces configured.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码运行结果中<code>Survivor</code>空间占用率为0%，而老年代有1168K被占用了，说明了allocation1和allocation2对象都直接进入了老年代，而没有等到15岁的临界年龄。他们加起来达到了512K，并且是同年的，满足同年对象达到<code>Survivor</code>空间的一半规则</p>
</blockquote>
<p><img src="VisualVM.png" alt="jdk1.8内存模型图"></p>
<h3 id="GC日志说明"><a href="#GC日志说明" class="headerlink" title="GC日志说明"></a>GC日志说明</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[GC[DefNew</span><br><span class="line">Desired survivor size <span class="number">524288</span> bytes, <span class="keyword">new</span> threshold <span class="number">1</span> (max <span class="number">15</span>)</span><br><span class="line">- age   <span class="number">1</span>:    <span class="number">1048576</span> bytes,    <span class="number">1048576</span> total</span><br><span class="line">: <span class="number">7093</span>K-&gt;<span class="number">1024</span>K(<span class="number">9216</span>K), <span class="number">0.0068300</span> secs] <span class="number">7093</span>K-&gt;<span class="number">1264</span>K(<span class="number">19456</span>K), <span class="number">0.0069039</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>GC：说明了本次GC日志类型，其他类型：FullGC，如果是FullGC则说明本次GC是Stop-The-World</p>
<p>DefNew：说明了本次GC发生的区域，其他类型：Tenured（老年代），Perm（永久带）。这里显示的区域名称与GC收集器密切相关，例如：<code>ParNew</code>收集器则显示为<code>ParNew</code>，如果是<code>ParallelScavenge</code>则为<code>PSYoungGen</code></p>
<p>方括号里的7093K-&gt;1024K(9216K)：GC前该区域已使用的容量 -&gt; GC后该区域已使用的容量（该内存区域总容量）</p>
<p>放括号外的7093K-&gt;1264K(19456K)：GC前堆区已使用容量 -&gt; GC后堆区已使用容量（堆总容量）</p>
<p>0.0068300 secs：表示新生代垃圾收集时间</p>
<p>0.0069039 secs：整个堆区垃圾收集时间</p>
<p>Times：user（用户态消耗的CPU时间）， sys（内核态消耗的CPU时间）, real（墙钟时间）</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/16/运行时数据区/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/16/运行时数据区/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">运行时数据区</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-16 15:21:32" itemprop="dateCreated datePublished" datetime="2019-02-16T15:21:32+08:00">2019-02-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="运行时数据区.png" alt="img"></p>
<h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><blockquote>
<p>用于存放对象实例</p>
<p>-Xms 初始化堆内存：-Xms2G  -Xms20M</p>
<p>-Xmx 最大堆内存：-Xmx2G -Xmx20M</p>
</blockquote>
<h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><blockquote>
<p>描述java方法执行的内存模型</p>
<p>每个方法执行时会创建一个栈帧用于存放局部变量表、操作数栈、动态链接、方法出口等信息</p>
<p>64位数据类型<code>long</code>和<code>double</code>占用2个局部变量表空间（Slot），其余数据类型占1个</p>
<p>-Xss 栈内存大小：-Xss128K</p>
</blockquote>
<h3 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h3><blockquote>
<p>存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据</p>
<p>-XX:PermSize 初始化方法区大小：-XX:PermSize=10M</p>
<p>-XX:MaxPermSize 最大方法区大小：-XX:MaxPermSize =10M</p>
</blockquote>
<h3 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h3><blockquote>
<p>执行Native方法，即C或C++方法</p>
</blockquote>
<h3 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h3><blockquote>
<p>记录程序执行的行号</p>
</blockquote>
<p>说明：以上运行时数据区是基于JDK1.6的，在1.8后<code>方法区</code>被<code>元数据区</code>取代且从堆中存入本地内存</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/26/NIO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/26/NIO/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">NIO</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-26 15:53:37" itemprop="dateCreated datePublished" datetime="2019-01-26T15:53:37+08:00">2019-01-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/24/网络编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/24/网络编程/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">网络编程</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-24 14:14:52" itemprop="dateCreated datePublished" datetime="2019-01-24T14:14:52+08:00">2019-01-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="客户端-服务器编程模型"><a href="#客户端-服务器编程模型" class="headerlink" title="客户端-服务器编程模型"></a>客户端-服务器编程模型</h3><blockquote>
<p>网络应用都是基于<code>客户端-服务器模型</code>的。采用这个模型，一个应用由一个<code>服务器进程</code>和一个或多个<code>客户端</code>进程组成。</p>
<ol>
<li>当一个客户端需要服务时，它向服务器发送一个请求，发起一个事务。例如：当web浏览器需要一个文件时，它就发送一个请求给web服务器</li>
<li>服务器收到请求后，解释它，并以适当的方式操作它的资源。例如：当web服务器收到浏览器发出的请求后，它就读一个磁盘文件</li>
<li>服务器给客户端发送一个响应，并等待下一个请求。例如：web服务器将文件发送回客户端</li>
<li>客户端收到响应并处理它。例如：当web浏览器收到来自服务器的一页后，就在屏幕上显示此页</li>
</ol>
</blockquote>
<h3 id="JAVA实现Http服务器"><a href="#JAVA实现Http服务器" class="headerlink" title="JAVA实现Http服务器"></a>JAVA实现Http服务器</h3><blockquote>
<ol>
<li>使用ServerSocket构造函数在一个特定端口创建一个新的ServerSocket</li>
<li>ServerSocket使用其accept()方法监听这个端口的入站连接。accept()方法会一直阻塞，直到一个客户端尝试建立连接，此时accept()将返回一个连接客户端和服务器的Socket对象</li>
<li>根据服务器的类型，会调用Socket的getInputStream()方法和getOutputStream()方法，或者这两个方法都调用，以获得与客户端通信的输入和输出流</li>
<li>服务器和客户端根据已协商的协议交互，直到关闭连接</li>
<li>服务器或客户端（或二者）关闭连接</li>
<li>服务器返回步骤2，等待下一次连接</li>
</ol>
<p>这个工程中设置将<code>D:\\ideaWorkspace2.5\\Socket\\src\\main\\WebRoot</code>作为应用的根目录，所有请求的资源会从该目录下开始寻找，启动服务后默认访问该目录下的<code>index.html</code>页面，将页面以字节流的形式返回给浏览器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.arthur.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xusheng on 2019/1/23.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JHttp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(JHttp.class.getCanonicalName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认处理请求的线程数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUM_THREADS = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认主页</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String INDEX_FILE = <span class="string">"index.html"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> File rootDirectory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务端口号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JHttp</span><span class="params">(File rootDirectory, Integer port)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!rootDirectory.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(rootDirectory + <span class="string">" is not a directory"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.rootDirectory = rootDirectory;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ExecutorService threadPool = Executors.newFixedThreadPool(NUM_THREADS);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> (ServerSocket server = <span class="keyword">new</span> ServerSocket(port)) &#123;</span><br><span class="line">                Socket request = server.accept();</span><br><span class="line">                Runnable requestProcesser = <span class="keyword">new</span> RequestProcessor(request,rootDirectory, INDEX_FILE);</span><br><span class="line">                threadPool.submit(requestProcesser);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String path = <span class="string">"D:\\ideaWorkspace2.5\\Socket\\src\\main\\WebRoot"</span>;</span><br><span class="line">        File rootDirectory = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JHttp httpServer = <span class="keyword">new</span> JHttp(rootDirectory, <span class="number">80</span>);</span><br><span class="line">            httpServer.start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.arthur.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xusheng on 2019/1/23.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestProcessor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(RequestProcessor.class.getCanonicalName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求信息，可以从中获取输入、输出流来进行交互</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Socket request;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 应用根目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> File rootDirectory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认主页</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String indexFileName = <span class="string">"index.html"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RequestProcessor</span><span class="params">(Socket request, File rootDirectory, String indexFileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rootDirectory.isFile()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"rootDirectionary must be a directory, not a file"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.rootDirectory = rootDirectory.getCanonicalFile();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (indexFileName != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.indexFileName = indexFileName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.request = request;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String root = rootDirectory.getPath();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            OutputStream raw = <span class="keyword">new</span> BufferedOutputStream(</span><br><span class="line">                    request.getOutputStream());</span><br><span class="line">            Writer writer = <span class="keyword">new</span> OutputStreamWriter(raw);</span><br><span class="line"></span><br><span class="line">            Reader reader = <span class="keyword">new</span> InputStreamReader(</span><br><span class="line">                            <span class="keyword">new</span> BufferedInputStream(</span><br><span class="line">                            request.getInputStream()), <span class="string">"US-ASCII"</span>);</span><br><span class="line"></span><br><span class="line">            StringBuilder requestLine = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> c = reader.read();</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="string">'\r'</span> || c == <span class="string">'\n'</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                requestLine.append((<span class="keyword">char</span>) c);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String get = requestLine.toString();</span><br><span class="line"></span><br><span class="line">            logger.info(request.getRemoteSocketAddress() + <span class="string">" "</span> + get);</span><br><span class="line">            String[] tokens = get.split(<span class="string">"\\s+"</span>);</span><br><span class="line">            String method = tokens[<span class="number">0</span>];</span><br><span class="line">            String version = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"GET"</span>.equals(method)) &#123;</span><br><span class="line">                String fileName = tokens[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (fileName.endsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">                    fileName += indexFileName;</span><br><span class="line">                &#125;</span><br><span class="line">                String contentType = URLConnection.getFileNameMap().getContentTypeFor(fileName);</span><br><span class="line">                <span class="keyword">if</span> (tokens.length &gt; <span class="number">2</span>) &#123;</span><br><span class="line">                    version = tokens[<span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                File theFile = <span class="keyword">new</span> File(rootDirectory, fileName.substring(<span class="number">1</span>, fileName.length()));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (theFile.canRead() &amp;&amp; theFile.getCanonicalPath().startsWith(root)) &#123;</span><br><span class="line">                    <span class="keyword">byte</span>[] theData = Files.readAllBytes(theFile.toPath());</span><br><span class="line">                    <span class="keyword">if</span> (version.startsWith(<span class="string">"HTTP/"</span>)) &#123;</span><br><span class="line">                        sendHeader(writer, <span class="string">"HTTP/1.0 200 OK"</span>, contentType, theData.length);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//发送文件，可能是一个图像或其他二进制数据，</span></span><br><span class="line">                    <span class="comment">//所以要使用底层输出流，而不是Writer</span></span><br><span class="line">                    raw.write(theData);</span><br><span class="line">                    raw.flush();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    String body = <span class="keyword">new</span> StringBuilder(<span class="string">"&lt;HTML&gt;\r\n"</span>)</span><br><span class="line">                            .append(<span class="string">"&lt;HEAD&gt;&lt;TITLE&gt;File Not Found&lt;/TITLE&gt;\r\n"</span>)</span><br><span class="line">                            .append(<span class="string">"&lt;/HEAD&gt;\r\n"</span>)</span><br><span class="line">                            .append(<span class="string">"&lt;BODY&gt;\r\n"</span>)</span><br><span class="line">                            .append(<span class="string">"&lt;H1&gt;HTTP Error 404：File Not Found&lt;/H1&gt;\r\n"</span>)</span><br><span class="line">                            .append(<span class="string">"&lt;/BODY&gt;&lt;/HTML&gt;\r\n"</span>)</span><br><span class="line">                            .toString();</span><br><span class="line">                    <span class="keyword">if</span> (version.startsWith(<span class="string">"HTTP/"</span>)) &#123;</span><br><span class="line">                        sendHeader(writer, <span class="string">"HTTP/1.0 404 File Not Found"</span>,</span><br><span class="line">                                <span class="string">"text/html; charset=utf-8"</span>, body.length());</span><br><span class="line">                    &#125;</span><br><span class="line">                    writer.write(body);</span><br><span class="line">                    writer.flush();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;<span class="comment">//不是GET方法</span></span><br><span class="line">                String body = <span class="keyword">new</span> StringBuilder(<span class="string">"&lt;HTML&gt;\r\n"</span>)</span><br><span class="line">                        .append(<span class="string">"&lt;HEAD&gt;&lt;TITLE&gt;Not Implemented&lt;/TITLE&gt;\r\n"</span>)</span><br><span class="line">                        .append(<span class="string">"&lt;/HEAD&gt;\r\n"</span>)</span><br><span class="line">                        .append(<span class="string">"&lt;BODY&gt;\r\n"</span>)</span><br><span class="line">                        .append(<span class="string">"&lt;H1&gt;HTTP Error 501：Not Implemented&lt;/H1&gt;\r\n"</span>)</span><br><span class="line">                        .append(<span class="string">"&lt;/BODY&gt;&lt;/HTML&gt;\r\n"</span>)</span><br><span class="line">                        .toString();</span><br><span class="line">                <span class="keyword">if</span> (version.startsWith(<span class="string">"HTTP/"</span>)) &#123;</span><br><span class="line">                    sendHeader(writer, <span class="string">"HTTP/1.0 501 Not Implemented"</span>,</span><br><span class="line">                            <span class="string">"text/html; charset=utf-8"</span>, body.length());</span><br><span class="line">                &#125;</span><br><span class="line">                writer.write(body);</span><br><span class="line">                writer.flush();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.log(Level.WARNING,</span><br><span class="line">                    <span class="string">"Error talking to "</span> + request.getRemoteSocketAddress(), e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                request.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                logger.log(Level.WARNING,</span><br><span class="line">                        <span class="string">"Error to close this socket"</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendHeader</span><span class="params">(Writer writer, String responseCode,</span></span></span><br><span class="line"><span class="function"><span class="params">                            String contentType, <span class="keyword">int</span> length)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        writer.write(responseCode + <span class="string">"\r\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"Date: "</span> + <span class="keyword">new</span> Date() + <span class="string">"\r\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"Server: JHttp 2.0\r\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"Content-length: "</span> + length + <span class="string">"\r\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"Content-type: "</span> + contentType + <span class="string">"\r\n\r\n"</span>);</span><br><span class="line">        writer.flush();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>以上实现的是一个多线程Http服务器，即每次请求都会从线程池中获取一个线程对请求进行处理。</p>
<p><strong>该模型的缺点：</strong>每个线程都只处理一个请求，如果在并发量很大，而请求处理很慢的情况下（例如：每个请求都执行一个查询，但查询非常慢），只能通过增加处理请求的线程数量来应对，但是操作系统支持的线程数是有限的（windows为2000左右，64位centos7为32768）。windows默认每个线程栈需要1M内存空间，32位的windows系统一个进程所能使用的最大虚拟内存为2G，所以理论上最多可以使用2048个线程，但是不可能将所有的内存都分配给线程所以window支持的线程数会小于理论值。linux系统可以通过<code>cat /proc/sys/kernel/pid_max</code>命令查看系统支持的最大线程数。</p>
</blockquote>
<h3 id="Linux的IO多路复用"><a href="#Linux的IO多路复用" class="headerlink" title="Linux的IO多路复用"></a>Linux的IO多路复用</h3><blockquote>
<p>针对上述模型的缺点Linux下有3种不同的解决方案，select、poll和epoll</p>
</blockquote>
<h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><blockquote>
<p>当请求1到达服务器时，此时分配线程1进行处理，但是请求1是一个慢查询，此时线程1可以将该事件记录到fd集合中，接着去处理请求2、请求3，它需要不断循环fd集合看哪些数据已经准备好，准备好了就继续执行。fd集合为数组（需要使用连续内存）</p>
</blockquote>
<h4 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h4><blockquote>
<p>poll与select实现机制一样，区别在于poll使用的fd集合为链表（可以使用不连续的内存）</p>
</blockquote>
<h4 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h4><blockquote>
<p>epoll也是需要轮询，但是轮询的是就绪列表。例如：请求1到达服务器时，线程1去处理，但是由于请求1是一个慢查询，所以线程1接着去处理请求2、请求3了，但是请求2和3查询也非常慢，此时请求1的数据已经从磁盘复制到了内存中，可以进行下一步操作了，线程1发现就绪列表中请求1的数据已经准备好了，就接着处理请求1，后面请求2、请求3数据准备完成后都会在就绪列表中，线程可以依次处理</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/15/系统级IO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/15/系统级IO/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">系统级IO</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-15 12:46:13" itemprop="dateCreated datePublished" datetime="2019-01-15T12:46:13+08:00">2019-01-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="系统级I-O"><a href="#系统级I-O" class="headerlink" title="系统级I/O"></a>系统级I/O</h3><blockquote>
<p> 输入操作从IO设备把数据复制到主存，输出操作是从主存复制数据到IO设备</p>
</blockquote>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><ul>
<li>普通文件：文本文件和二进制文件</li>
<li>目录：包含一组<code>链接</code>的文件，其中每个链接都将一个文件名映射到一个文件，这个文件可能是另一个目录</li>
<li>套接字：用来与另一个进程进行跨网络通信的文件</li>
</ul>
<h3 id="打开和关闭文件"><a href="#打开和关闭文件" class="headerlink" title="打开和关闭文件"></a>打开和关闭文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">open</span> <span class="params">(<span class="keyword">char</span> *filename, <span class="keyword">int</span> flags, <span class="keyword">mode_t</span> mode)</span></span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>进程通过open函数来打开一个已存在的文件或者创建一个新文件</p>
</blockquote>
<h3 id="读和写文件"><a href="#读和写文件" class="headerlink" title="读和写文件"></a>读和写文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ssize_t</span> read(<span class="keyword">int</span> fd, <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> n);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ssize_t</span> write(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> n);</span><br></pre></td></tr></table></figure>
<h3 id="读取目录内容"><a href="#读取目录内容" class="headerlink" title="读取目录内容"></a>读取目录内容</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">DIR *<span class="title">opendir</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="function">struct dirent *<span class="title">readdir</span><span class="params">(DIR * dirp)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">closedir</span><span class="params">(DIR *dirp)</span></span>;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/14/Maven基础应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arthur">
      <meta itemprop="description" content="个人笔记">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/14/Maven基础应用/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">Maven基础应用</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-14 21:26:16" itemprop="dateCreated datePublished" datetime="2019-01-14T21:26:16+08:00">2019-01-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-15 10:57:41" itemprop="dateModified" datetime="2019-06-15T10:57:41+08:00">2019-06-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="常用标签"><a href="#常用标签" class="headerlink" title="常用标签"></a>常用标签</h3><h4 id="mirror标签配置私服"><a href="#mirror标签配置私服" class="headerlink" title="mirror标签配置私服"></a>mirror标签配置私服</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>ylcloud-repo<span class="tag">&lt;/<span class="name">id</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>ylcloud-repo<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ylcloud-repo:5001/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="proxy标签配置代理"><a href="#proxy标签配置代理" class="headerlink" title="proxy标签配置代理"></a>proxy标签配置代理</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">proxy</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">active</span>&gt;</span>true<span class="tag">&lt;/<span class="name">active</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">protocol</span>&gt;</span>http<span class="tag">&lt;/<span class="name">protocol</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">host</span>&gt;</span>代理服务器地址<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">port</span>&gt;</span>代理服务器的端口<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">nonProxyHosts</span>&gt;</span>不使用代理的主机<span class="tag">&lt;/<span class="name">nonProxyHosts</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="pluginGroups插件"><a href="#pluginGroups插件" class="headerlink" title="pluginGroups插件"></a>pluginGroups插件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- pluginGroup</span></span><br><span class="line"><span class="comment">     | Specifies a further group identifier to use for plugin lookup.</span></span><br><span class="line"><span class="comment">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="servers配置私服用户名密码等"><a href="#servers配置私服用户名密码等" class="headerlink" title="servers配置私服用户名密码等"></a>servers配置私服用户名密码等</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>id<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="profiles，activeProfile配置不同环境"><a href="#profiles，activeProfile配置不同环境" class="headerlink" title="profiles，activeProfile配置不同环境"></a>profiles，activeProfile配置不同环境</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>ylcloud<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">repository</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>ylcloud-repo<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ylcloud-repo<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>ylcloud-repo<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ylcloud-repo<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>backup<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">repository</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>backup<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo1.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>backup<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo1.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>ylcloud<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="packaging"><a href="#packaging" class="headerlink" title="packaging"></a>packaging</h4><blockquote>
<p>jar：打成jar包，springboot项目一般多用jar包启动</p>
<p>war：部署到tomcat下</p>
<p>pom：聚合工程</p>
<p>maven-plugin</p>
</blockquote>
<h4 id="dependencyManagement"><a href="#dependencyManagement" class="headerlink" title="dependencyManagement"></a>dependencyManagement</h4><blockquote>
<p> 只能出现在父pom工程，不是给子类直接用的，需要使用时还是需要自己引用，类似抽象类，可以对版本进行控制</p>
</blockquote>
<h4 id="scope"><a href="#scope" class="headerlink" title="scope"></a>scope</h4><blockquote>
<p>compile 编译（默认）</p>
<p>test 测试</p>
<p>provided 编译，例如：Servlet，打包时不会打进去</p>
<p>runtime 运行时有效，编译时可以不用，jdbc驱动实现</p>
<p>system 本地一些jar加上systemPath</p>
</blockquote>
<h4 id="依赖仲裁"><a href="#依赖仲裁" class="headerlink" title="依赖仲裁"></a>依赖仲裁</h4><blockquote>
<p>最短路径，pom书写顺序，exclusions排除包</p>
</blockquote>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><blockquote>
<p>clean：pre-clean,clean,post-clean</p>
<p>default：compile,package,install,deploy….</p>
<p>site：pre-site,site,post-site,site-deploy</p>
</blockquote>
<p>​    </p>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><blockquote>
<p>clean:删除target</p>
<p>compile:编译</p>
<p>test:运行项目中所有的测试用例</p>
<p>install:    将模块安装到本地仓库</p>
<p>package:打包</p>
<p>deploy:把本地jar发布到远程仓库中</p>
</blockquote>
<p>​    </p>
<h4 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a>常用插件</h4><blockquote>
<p>mojo，findbugs，versions，source</p>
</blockquote>
<p>mvn dependency:tree &gt; d.txt</p>
<p>mvn clean package -U 强制从版本库拉一次</p>
<p>maven-model-builder-3.3.9.jar/org/apache/maven/model中有超级pom</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Arthur</p>
              <p class="site-description motion-element" itemprop="description">个人笔记</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Arthur</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
